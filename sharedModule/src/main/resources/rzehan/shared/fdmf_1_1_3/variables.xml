<dmf>

    <description>
        Zde jsou definovány proměnné. K jejich vyhodnocení jsou použity funkce, další proměnné, vzory a
        konstanty.
        Proměnné je možné dynamicky doplňovat/upravovat.
        Nesmí ale nastat situace cyklu, tedy že by hodnota proměnné X závisela na proměnné/vzoru Y, která by závisela na
        proměnné X.
        Proměnné mohou obsahovat pouze velká písmena latinské abecedy, číslice a znaky '-','_';
    </description>


    <!--tj. musi byt dodano pres GUI nebo CLI-->
    <value-def name="PSP_DIR" type="FILE">
        <evaluation functionName="PROVIDED_FILE">
            <params>
                <value name="file_id" type="STRING">PSP_DIR</value>
            </params>
        </evaluation>
    </value-def>

    <!--TODO: jen docasne, dokud nebude implementovano ziskavani ze souboru INFO-->
    <!--<value-def name="PSP_ID" type="STRING">
        <evaluation functionName="PROVIDED_STRING">
            <params>
                <value name="string_id" type="STRING">PSP_ID</value>
            </params>
        </evaluation>
    </value-def>-->

    <value-def name="PSP_ID" type="STRING">
        <evaluation functionName="getStringByXpath">
            <params>
                <value name="xml_file" type="FILE">
                    <!--pozor, tady se soubor INFO ziskava jinak, nez podle vzoru INFO_FILENAME.
                    Protoze PSP_ID teprve zjistujeme, nemuzeme pouzit vzor INFO_FILENAME, ten ma hodnotu promenne PSP_ID
                    jako svuj paramer.-->
                    <!--jeden kandidat na soubor INFO-->
                    <evaluation functionName="RETURN_FIRST_FILE_FROM_LIST">
                        <params>
                            <value name="files" type="FILE_LIST">
                                <!--kandidati na soubor INFO podle vzoru a v danem adresari-->
                                <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
                                    <params>
                                        <value name="dir" type="FILE">
                                            <value-ref name="PSP_DIR"/>
                                        </value>
                                        <pattern name="pattern">
                                            <pattern-ref name="INFO_FILENAME_FOR_PSP_ID_DETECTION"/>
                                        </pattern>
                                    </params>
                                </evaluation>
                            </value>
                        </params>
                    </evaluation>
                </value>
                <value name="xpath" type="STRING">/info/packageid</value>
            </params>
        </evaluation>
    </value-def>


    <value-def name="INFO_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="PSP_DIR"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="INFO_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <value-def name="PRIMARY-METS_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="PSP_DIR"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="PRIMARY-METS_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <value-def name="CHECKSUM_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="PSP_DIR"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="CHECKSUM_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>


    <value-def name="TOLERATED_TL_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="PSP_DIR"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="TOLERATED_TL_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <value-def name="INFO_FILE" type="FILE">
        <evaluation functionName="RETURN_FIRST_FILE_FROM_LIST">
            <params>
                <value name="files" type="FILE_LIST">
                    <value-ref name="INFO_FILES"/>
                </value>
            </params>
        </evaluation>
    </value-def>

    <value-def name="PRIMARY-METS_FILE" type="FILE">
        <evaluation functionName="RETURN_FIRST_FILE_FROM_LIST">
            <params>
                <value name="files" type="FILE_LIST">
                    <value-ref name="PRIMARY-METS_FILES"/>
                </value>
            </params>
        </evaluation>
    </value-def>

    <value-def name="CHECKSUM_FILE" type="FILE">
        <evaluation functionName="RETURN_FIRST_FILE_FROM_LIST">
            <params>
                <value name="files" type="FILE_LIST">
                    <value-ref name="CHECKSUM_FILES"/>
                </value>
            </params>
        </evaluation>
    </value-def>

    <value-def name="SECONDARY-METS-DIR_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="PSP_DIR"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="SECONDARY-METS-DIR_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <value-def name="OCR-TEXT-DIR_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="PSP_DIR"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="OCR-TEXT-DIR_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <value-def name="OCR-ALTO-DIR_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="PSP_DIR"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="OCR-ALTO-DIR_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>


    <value-def name="MASTER-COPY-DIR_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="PSP_DIR"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="MASTER-COPY-DIR_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <value-def name="USER-COPY-DIR_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="PSP_DIR"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="USER-COPY-DIR_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <value-def name="SECONDARY-METS-DIR_FILE" type="FILE">
        <evaluation functionName="RETURN_FIRST_FILE_FROM_LIST">
            <params>
                <value name="files" type="FILE_LIST">
                    <value-ref name="SECONDARY-METS-DIR_FILES"/>
                </value>
            </params>
        </evaluation>
    </value-def>

    <value-def name="OCR-TEXT-DIR_FILE" type="FILE">
        <evaluation functionName="RETURN_FIRST_FILE_FROM_LIST">
            <params>
                <value name="files" type="FILE_LIST">
                    <value-ref name="OCR-TEXT-DIR_FILES"/>
                </value>
            </params>
        </evaluation>
    </value-def>

    <value-def name="OCR-ALTO-DIR_FILE" type="FILE">
        <evaluation functionName="RETURN_FIRST_FILE_FROM_LIST">
            <params>
                <value name="files" type="FILE_LIST">
                    <value-ref name="OCR-ALTO-DIR_FILES"/>
                </value>
            </params>
        </evaluation>
    </value-def>

    <value-def name="MASTER-COPY-DIR_FILE" type="FILE">
        <evaluation functionName="RETURN_FIRST_FILE_FROM_LIST">
            <params>
                <value name="files" type="FILE_LIST">
                    <value-ref name="MASTER-COPY-DIR_FILES"/>
                </value>
            </params>
        </evaluation>
    </value-def>

    <value-def name="USER-COPY-DIR_FILE" type="FILE">
        <evaluation functionName="RETURN_FIRST_FILE_FROM_LIST">
            <params>
                <value name="files" type="FILE_LIST">
                    <value-ref name="USER-COPY-DIR_FILES"/>
                </value>
            </params>
        </evaluation>
    </value-def>

    <value-def name="SECONDARY-METS_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="SECONDARY-METS-DIR_FILE"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="SECONDARY-METS_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <value-def name="OCR-TEXT_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="OCR-TEXT-DIR_FILE"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="OCR-TEXT_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <value-def name="OCR-ALTO_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="OCR-ALTO-DIR_FILE"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="OCR-ALTO_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <value-def name="MASTER-COPY_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="MASTER-COPY-DIR_FILE"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="MASTER-COPY_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <value-def name="USER-COPY_FILES" type="FILE_LIST">
        <evaluation functionName="FIND_FILES_IN_DIR_BY_PATTERN">
            <params>
                <value name="dir" type="FILE">
                    <value-ref name="USER-COPY-DIR_FILE"/>
                </value>
                <pattern name="pattern">
                    <pattern-ref name="USER-COPY_FILENAME"/>
                </pattern>
            </params>
        </evaluation>
    </value-def>

    <!--soubory XSD-->

    <value-def name="INFO_XSD_FILE" type="FILE">
        <evaluation functionName="PROVIDED_FILE">
            <!--tj. musi byt dodano pres GUI nebo CLI na zaklade konkretni fDMF-->
            <params>
                <value name="file_id" type="STRING">INFO_XSD_FILE</value>
            </params>
        </evaluation>
    </value-def>

    <!--TODO: podobne ostatni XSD-->


    <!--zpracování INFO-->
    <!--todo: implementovat ef-->
    <!--<variable name="INFO_ITEMTOTAL" type="INTEGER">
        <description>hodnota /info/itemlist/@itemtotal ze souboru INFO</description>

        <evaluation functionName="GET_INT_BY_XPATH">
            <params>
                <param name="file">
                    <variable name="INFO_FILE"/>
                </param>
                <param name="xpath">
                    <xpath>/info/itemlist/@itemtotal</xpath>
                </param>
            </params>
        </evaluation>
    </variable>-->

    <!--todo: implementovat ef-->
    <!--<variable name="INFO_ITEMS" type="STRING_LIST">
        <description>seznam hodnot /info/itemlist/item ze souboru INFO</description>
        <evaluation functionName="GET_STRING_LIST_BY_XPATH">
            <params>
                <param name="file">
                    <variable name="INFO_FILE"/>
                </param>
                <param name="xpath">
                    <xpath>/info/itemlist/item</xpath>
                </param>
            </params>
        </evaluation>
    </variable>-->

    <!--TEST, takhle by mohlo definovani promene nove vypadat se obema typy parametru  (hodnota, vzor) a obema typy zapisu - odkazem a definici-->


    <!--TEST: ruzne moznosti hodnoty pres definici-->


</dmf>